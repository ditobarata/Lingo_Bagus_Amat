<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arabic Master SPA - Njawani</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700&family=Noto+Naskh+Arabic:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
    <div id="app" v-cloak>
        <div class="kawung-bg"></div>

        <div v-if="showSplash" class="splash-overlay">
            <div class="splash-card">
                <h2>Selamat Datang di Mode Al-Qur'an</h2>
                <p>
                    Aplikasi ini menggunakan <strong>Quran.com API v4</strong> sebagai sumber data ayat,
                    tajwid, transliterasi, dan terjemahan. API ini dipakai secara luas di ekosistem digital
                    Al-Qur'an dan dikelola secara profesional sehingga dapat dipertanggungjawabkan sebagai
                    rujukan teknis penyajian data.
                </p>
                <p>
                    Aplikasi <strong>tidak mengubah isi surat</strong>. Teks Al-Qur'an ditampilkan apa adanya dari API;
                    aplikasi hanya mengatur pilihan font dan pewarnaan tajwid sesuai penandaan yang diberikan API.
                </p>
                <p class="splash-doa">
                    Selamat membaca Al-Qur'an. Semoga Allah memudahkan langkah Anda untuk segera khatam.
                </p>
                <button class="btn-splash" @click="tutupSplash">Mulai Membaca</button>
            </div>
        </div>

        <div class="card">
            <nav class="app-nav">
                <div class="nav-item" :class="{active: currentMode === 'lingo'}" @click="currentMode = 'lingo'">Bhs Arab</div>
                <div class="nav-item" :class="{active: currentMode === 'quran'}" @click="currentMode = 'quran'">Al-Qur'an</div>
            </nav>

            <div class="user-profile">
                <p class="greeting">
                    Salam, <span class="user-name" @click="changeName">{{ settings.userName }}</span>
                    <i class="fa-solid fa-pen-to-square edit-icon"></i>
                </p>
            </div>

            <hr class="sogan-divider">

            <div v-if="currentMode === 'lingo'" class="mode-container">
                <div class="arabic" @click="toggleGundul">
                    {{ settings.isGundul ? currentKalimat.gundul : currentKalimat.ar }}
                </div>
                <div class="latin" :class="{ 'blur': settings.isBlurLatin }" @click="toggleSetting('isBlurLatin')">
                    {{ currentKalimat.lat }}
                </div>
                <div class="indo" :class="{ 'blur': settings.isBlurIndo }" @click="toggleSetting('isBlurIndo')">
                    {{ currentKalimat.id }}
                </div>
                <div class="structure-box" v-if="showStructure">
                    <strong>Struktur:</strong> {{ currentKalimat.struktur }}
                </div>
                <div class="btn-group">
                    <button class="btn-struct" @click="showStructure = !showStructure">
                        {{ showStructure ? 'Tutup Struktur' : 'Bedah Struktur' }}
                    </button>
                    <button class="btn-next" @click="tampilkanAcak">Ganti Kalimat →</button>
                </div>
            </div>

            <div v-if="currentMode === 'quran'" class="mode-container">
                <div class="quran-header" style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                    <h3 style="color: var(--sogan-dark); margin: 0;">
                        {{ activeSurahTitle }}
                    </h3>
                </div>
                <div v-if="activeAyatInfo" class="last-read-indicator">
                    Posisi baca: {{ activeAyatInfo.chapterNumber }}:{{ activeAyatInfo.nomorAyat }}
                    • Ayat global: {{ activeAyatInfo.globalAyat }}
                    • Rentang dimuat: {{ quranWindowStart }}-{{ quranWindowEnd }}
                </div>

                <div v-if="loading" class="loading-text">
                    {{ syncStatus || 'Mendhak data...' }}
                    <div v-if="isSyncing" class="sync-progress-wrap">
                        <div class="sync-progress-meta">
                            <span>{{ syncCurrent }}/{{ syncTotal }} surah</span>
                            <strong>{{ syncPercent }}%</strong>
                        </div>
                        <div class="sync-progress-track">
                            <div class="sync-progress-fill" :style="{ width: syncPercent + '%' }"></div>
                        </div>
                    </div>
                </div>

                <div v-else class="scroll-container" ref="ayatScrollContainer" @scroll.passive="onAyatScroll">
                    <div class="ayat-list">
                        <div
                            v-for="(ayat, index) in daftarAyat"
                            :key="ayat.globalAyat"
                            class="ayat-item"
                            :class="{ 'is-active-ayat': activeAyatGlobal === ayat.globalAyat }"
                            :data-global="ayat.globalAyat"
                        >
                            <div
                                v-if="index === 0 || daftarAyat[index - 1].chapterNumber !== ayat.chapterNumber"
                                class="surah-change-marker"
                            >
                                <span class="surah-change-latin">{{ getSurahLatinName(ayat.chapterNumber) }}</span>
                                <span class="surah-change-arabic">{{ getSurahArabicName(ayat.chapterNumber) }}</span>
                            </div>
                            <div class="ayat-top">
                                <span class="ayat-nomor">{{ ayat.chapterNumber }}:{{ ayat.nomorAyat }}</span>
                                <p class="arabic-ayat" v-html="ayat.teksArab"></p>
                            </div>
                            <p class="latin-ayat">{{ ayat.teksLatin }}</p>
                            <p class="indo-ayat">{{ ayat.teksIndonesia }}</p>
                        </div>
                    </div>
                </div>
                <div v-if="isWindowRefreshing" class="loading-text window-refreshing-text">
                    Menyesuaikan jendela ayat...
                </div>
            </div>
        </div>
    </div>

    <script src="data.js"></script>
    <script src="app.js"></script> </body>
</html>
